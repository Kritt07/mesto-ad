(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"ce314302-0f3f-4cf5-aaac-ae528920b032","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),R=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(u),V=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(u),H=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(u),z=({avatar:e})=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(u),K=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(u),G=({cardId:e})=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(u),A=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(u),M=(e,t,o)=>{const r=e.classList.contains("card__like-button_is-active");o(t,r).then(n=>{e.classList.toggle("card__like-button_is-active"),e.nextElementSibling.textContent=n.likes.length}).catch(n=>{console.error("Ошибка при изменении статуса лайка:",n)})},Q=(e,t,o)=>{o({cardId:t}).then(()=>{e.remove()}).catch(r=>{console.error("Ошибка при удалении карточки:",r)})},X=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),F=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,currentUserId:n})=>{const c=X(),a=c.querySelector(".card__like-button"),x=c.querySelector(".card__control-button_type_delete"),v=c.querySelector(".card__image");return v.src=e.link,v.alt=e.name,c.querySelector(".card__title").textContent=e.name,e.owner._id,e.owner._id!=n&&x.remove(),r&&x.addEventListener("click",()=>r(c,e._id)),e.likes.some(J=>J._id===n)&&a.classList.add("card__like-button_is-active"),o&&a.addEventListener("click",()=>{o(a,e._id,e.likes.length),a.nextElementSibling.textContent=e.likes.length}),a.nextElementSibling.textContent=e.likes.length,t&&v.addEventListener("click",()=>t({name:e.name,link:e.link})),c},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})},Z=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",r=>{r.preventDefault()}),ee(o,e)})},ee=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector));B(e,t),o.forEach(r=>{r.addEventListener("input",()=>{te(e,r,t),B(e,t)})})},te=(e,t,o)=>{if(t.validity.valid)w(e,t,o);else{let r=t.validationMessage;t.validity.patternMismatch&&t.dataset.errorMessage&&(r=t.dataset.errorMessage),oe(e,t,r,o)}},oe=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},w=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass)},re=e=>e.some(t=>!t.validity.valid),B=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);re(o)?T(r,t):ne(r,t)},T=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},ne=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},b=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{w(e,n,t),n.value=n.value}),T(r,t)},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Z(h);const O=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),d=L.querySelector(".popup__form"),D=d.querySelector(".popup__input_type_name"),N=d.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),l=C.querySelector(".popup__form"),ce=l.querySelector(".popup__input_type_card-name"),se=l.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),U=q.querySelector(".popup__image"),ae=q.querySelector(".popup__caption"),le=document.querySelector(".profile__edit-button"),ie=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),p=I.querySelector(".popup__form"),ue=p.querySelector(".popup__input"),P=document.querySelector(".popup_type_remove-card"),de=P.querySelector(".popup__form");let f=null,y=null,S;const m=(e,t)=>{let o=e.querySelector(".popup__button");o.textContent=t},W=({name:e,link:t})=>{U.src=t,U.alt=e,ae.textContent=e,_(q)},pe=e=>{e.preventDefault(),m(d,"Сохранение..."),H({name:D.value,about:N.value}).then(t=>{g.textContent=t.name,k.textContent=t.about,i(L)}).catch(t=>{console.log("ошибка при получении данных об имени и описании пользователя",t)}).finally(()=>m(d,"Сохранить"))},me=e=>{e.preventDefault(),m(p,"Сохранение..."),z({avatar:ue.value}).then(t=>{E.style.backgroundImage=`url(${t.avatar})`,i(I)}).catch(t=>{console.log(t)}).finally(()=>m(p,"Сохранить"))},_e=e=>{e.preventDefault(),f&&y&&(Q(f,y,G),i(P),f=null,y=null)},j=(e,t)=>{f=e,y=t,_(P)},fe=e=>{e.preventDefault(),m(l,"Создание..."),K({name:ce.value,link:se.value}).then(t=>{O.prepend(F(t,{onPreviewPicture:W,onLikeIcon:(o,r)=>M(o,r,A),onDeleteCard:j,currentUserId:S})),i(C),l.reset()}).catch(t=>{console.log(t)}).finally(()=>m(l,"Создать"))};d.addEventListener("submit",pe);l.addEventListener("submit",fe);p.addEventListener("submit",me);de.addEventListener("submit",_e);le.addEventListener("click",()=>{D.value=g.textContent,N.value=k.textContent,b(d,h),_(L)});E.addEventListener("click",()=>{p.reset(),b(p,h),_(I)});ie.addEventListener("click",()=>{l.reset(),b(l,h),_(C)});const ye=document.querySelectorAll(".popup");ye.forEach(e=>{Y(e)});Promise.all([V(),R()]).then(([e,t])=>{E.style.backgroundImage=`url(${t.avatar})`,g.textContent=t.name,k.textContent=t.about,S=t._id,e.forEach(o=>{O.append(F(o,{onPreviewPicture:W,onLikeIcon:(r,n)=>M(r,n,A),onDeleteCard:j,currentUserId:S}))})}).catch(e=>{console.log(e)});
